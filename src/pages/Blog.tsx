import { useState, useEffect, useCallback } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import Icon from "@/components/ui/icon";

const HERO_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/e4ac2b08-3aae-426d-8a8d-5a22b4314c54.jpg";
const ELEPHANT_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/b9988101-71aa-41dc-9a8c-d4538f335604.jpg";
const CAPETOWN_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/acdb17c2-4cd7-4ffb-af60-5a406c1f94bb.jpg";
const LION_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/939c17fa-9f72-48a5-af65-83328c3336d7.jpg";
const GARDENROUTE_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/2e2b4e11-37d8-4d01-83c2-905f2e60c177.jpg";
const PENGUINS_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/e4169764-f4bb-4d7f-b6f1-304c79257ed0.jpg";
const WATERFRONT_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/e9ca5616-786f-4cd2-87ab-0235739e3818.jpg";
const BOKAAP_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/02e1a9db-2ecf-465e-aa8b-da8d0c1be22d.jpg";
const CAPEPOINT_IMG = "https://cdn.poehali.dev/projects/6304529a-c8b4-435e-aa43-429aa3c665eb/files/c3ee904f-7e6c-43f9-b487-f6c0ec3dc0f0.jpg";

const u = (id: string) => `https://images.unsplash.com/photo-${id}?w=800&q=80&auto=format&fit=crop`;

const ALL_POSTS = [
  {
    img: ELEPHANT_IMG,
    tag: "Дикая природа",
    date: "14 фев 2026",
    title: "Большая пятёрка Крюгера: что нужно знать перед сафари",
    excerpt: "Крюгер — одно из крупнейших заповедников мира. Делюсь маршрутом, советами и лучшими точками для наблюдения за животными.",
    content: `Крюгер — это не просто заповедник, это целый мир размером с небольшую страну. Почти два миллиона гектаров дикой природы, где живут слоны, носороги, буйволы, леопарды и, конечно, львы — та самая Большая пятёрка.

Я приехал сюда без особых ожиданий, просто хотел провести несколько дней в тишине. Но уже на второй час после въезда в ворота Нумби наш джип окружило стадо слонов — штук двадцать, не меньше. Они шли медленно, совершенно не обращая на нас внимания. Это было одно из самых сильных впечатлений в жизни.

**Лучшие маршруты**

Я объехал северную и центральную части парка. Для первого раза рекомендую базироваться в лагере Сатара — он стоит прямо в центре, и отсюда удобно выезжать в любую сторону. Утренние и вечерние сафари — самые богатые на встречи с животными: в эти часы вся живность активна.

**Практические советы**

Бронируйте лагерь за несколько месяцев. Езжайте медленно — максимальная скорость внутри парка 50 км/ч, но реально нужно идти 20–30, чтобы успевать замечать животных в кустах. Бинокль обязателен. И не выходите из машины нигде, кроме специально отведённых площадок — это не шутки.`,
  },
  {
    img: CAPETOWN_IMG,
    tag: "Города",
    date: "2 фев 2026",
    title: "Кейптаун: город у двух океанов и одной горы",
    excerpt: "Столовая гора, Bo-Kaap, мыс Доброй Надежды — всё, что нужно увидеть в южной столице ЮАР за 5 дней.",
    content: `Кейптаун — это город, который невозможно описать одним словом. Он одновременно африканский и европейский, шумный и тихий, опасный и невероятно красивый.

Первое, что видишь, когда летишь сюда, — Столовую гору. Она просто висит над городом, плоская и величественная. Подняться на неё можно на канатной дороге — виды сверху захватывают дух: весь полуостров как на ладони, слева Атлантика, справа — Индийский океан.

**5 мест, которые нельзя пропустить**

Столовая гора. Bo-Kaap — разноцветный малайский квартал с лучшим самосой в городе. Waterfront — портовый район с ресторанами и магазинами. Chapman's Peak Drive — прибрежная дорога, от которой перехватывает дыхание. Robben Island — остров, где сидел Мандела.

**Безопасность**

Кейптаун красив, но неоднороден. Туристические районы безопасны, но за пределами знакомых мест лучше брать Uber, а не ходить пешком.`,
  },
  {
    img: LION_IMG,
    tag: "Дикая природа",
    date: "25 янв 2026",
    title: "Как найти льва в Крюгере: советы рейнджера",
    excerpt: "Лев — главная звезда сафари. Но найти его не так просто. Делюсь профессиональными советами, где и когда искать.",
    content: `Лев — царь зверей и главный приз сафари. Но в отличие от жирафа или слона, которых видно издалека, лев умеет прятаться.

**Где искать**

Открытые равнины — логово прайда. Ищите их в высокой траве у водопоев, под одиноко стоящими деревьями в жаркий полдень, у туш убитых животных.

**Когда искать**

Рассвет и закат — самое активное время. Средина дня — лев спит. Но! Именно в полдень, когда другие туристы едут обедать, я нашёл самый большой прайд в своей жизни — 23 льва у реки Нвалетан.

**Следите за птицами**

Грифы, кружащие над одной точкой — там туша. Там почти всегда лев. Треск кустов и тревожный лай зебр или импал — хищник рядом.

**Прайды Крюгера**

В парке около 1500 львов — это один из самых высоких показателей в мире. Центральный и северный районы — самые богатые. Рейнджеры знают все прайды по именам.`,
  },
  {
    img: WATERFRONT_IMG,
    tag: "Города",
    date: "18 янв 2026",
    title: "V&A Waterfront: сердце Кейптауна",
    excerpt: "Бывший рыбный порт стал самым посещаемым туристическим местом ЮАР. Рестораны, музеи, паромы на Robben Island.",
    content: `Victoria & Alfred Waterfront — это место, где старый рыбацкий порт встречается с современным городом. Здесь всегда что-то происходит: живая музыка, уличные художники, запах рыбы и кофе.

**Что делать**

Robben Island Ferry отправляется отсюда. Two Oceans Aquarium — один из лучших в Африке. Nobel Square — статуи четырёх нобелевских лауреатов ЮАР. Market on the Wharf — еда со всего мира.

**Где есть**

Den Anker — бельгийский ресторан с видом на яхты. Harbour House — морепродукты прямо над водой. Baia Seafood Restaurant — лучший лобстер в городе.

**Закат с Waterfront**

Столовая гора розовеет, яхты качаются на воде, уличные музыканты играют джаз. Это не туристическая открытка — это реальная жизнь Кейптауна.`,
  },
  {
    img: BOKAAP_IMG,
    tag: "Культура",
    date: "10 янв 2026",
    title: "Bo-Kaap: разноцветная история Кейптауна",
    excerpt: "Розовые, жёлтые, синие дома, мечеть и запах кардамона — малайский квартал Bo-Kaap хранит историю рабства и освобождения.",
    content: `Bo-Kaap — один из старейших кварталов Кейптауна, основанный потомками малайских рабов, привезённых голландцами в XVII веке. Их потомки — кейп-малаи — живут здесь до сих пор.

**Разноцветные дома**

Яркие фасады появились после отмены апартеида в 1994 году как символ свободы. Каждый дом — свой цвет. Фотографировать можно, но уважайте жителей — это не декорации, а реальные дома.

**Музей Bo-Kaap**

Один из старейших домов квартала превращён в музей. Узнаете об истории кейп-малайской общины, традиционной кухне и исламе.

**Еда**

Самоса, боботи, кейп-малайское карри — кухня, которую больше нигде не попробуешь. Лучший ресторан — The Bo-Kaap Kombuis на Rose Street.

**Когда приходить**

Рано утром или вечером — меньше туристов, лучший свет для фотографий.`,
  },
  {
    img: PENGUINS_IMG,
    tag: "Дикая природа",
    date: "3 янв 2026",
    title: "Пляж Боулдерс: где живут африканские пингвины",
    excerpt: "Единственная колония африканских пингвинов, доступная пешком. 30 минут от Кейптауна — и вы среди тысяч птиц.",
    content: `Боулдерс — пляж в маленьком городке Саймонс-Таун на полуострове Кейп. Здесь живёт колония африканских пингвинов — вид, находящийся под угрозой исчезновения.

**Как добраться**

45 минут на машине из Кейптауна по живописной прибрежной дороге M4. Вход через National Parks — около 200 рандов. Деревянные настилы проведут прямо сквозь колонию.

**Пингвины и люди**

Птицы совершенно не боятся людей. Они гуляют по настилам, сидят под кустами, купаются рядом с туристами. Иногда пингвин просто идёт рядом с вами — это сюрреалистично.

**Лучшее время**

Октябрь–январь — сезон гнездования, можно увидеть птенцов. Ранее утро — меньше людей, активнее птицы.

**Почему вид под угрозой**

Сокращение рыбных запасов, нефтяные разливы, изменение климата. Колония на Боулдерсе — одна из немногих оставшихся.`,
  },
  {
    img: CAPEPOINT_IMG,
    tag: "Природа",
    date: "27 дек 2025",
    title: "Cape Point: где заканчивается Африка",
    excerpt: "Самая юго-западная точка Африки. Маяк, обрывы над океаном, дикие бабуины и страусы — день на мысе Доброй Надежды.",
    content: `Cape Point — часть Столового горного национального парка. Это один из самых ветреных и драматичных ландшафтов в мире.

**Маяк**

Старый маяк на вершине скалы — один из символов ЮАР. Подняться можно пешком или на фуникулёре. С вершины — вид на оба океана и весь полуостров.

**Дикая природа**

Бабуины здесь знамениты — они открывают машины и крадут еду. Не кормите их и держите окна закрытыми. Также встречаются зебры, страусы, антилопы.

**Лучший маршрут**

Войдите через ворота Торнтон-роуд. Сначала — мыс Доброй Надежды (знак и скала), потом — Cape Point с маяком. Выходите через ту же дорогу или объездом через Сомон-Таун с заездом на Боулдерс.

**Погода**

Ветер здесь постоянный. Приходите в любую погоду — в шторм особенно впечатляет.`,
  },
  {
    img: HERO_IMG,
    tag: "Природа",
    date: "20 дек 2025",
    title: "Сафари самостоятельно: всё что нужно знать",
    excerpt: "Организовать сафари в ЮАР самостоятельно проще, чем кажется. Аренда машины, бронирование лагерей, маршруты — полный гид.",
    content: `Большинство людей думают, что сафари — это дорогой организованный тур с гидом. Но в ЮАР всё иначе: вы можете въехать в Крюгер на своей арендованной машине и делать сафари самостоятельно.

**Аренда машины**

Обычный седан или хэтчбек — достаточно для большинства дорог Крюгера. Внедорожник нужен только если планируете ехать на север или в дождливый сезон. Арендуйте в аэропорту Йоханнесбурга.

**Въезд в Крюгер**

Ворот несколько. Для первого раза рекомендую Орпен или Пабализи — центральная часть, самая богатая животными. Входной билет — около 400 рандов с человека в день.

**Лагеря**

Официальные лагери SANParks: Сатара, Скукуза, Берг-эн-Даль. Есть коттеджи, бунгало, кемпинг. Бронируйте за 3–6 месяцев через sanparks.org.

**Правила**

Не выходить из машины. Не кормить животных. Соблюдать скоростной режим. Выезжать до рассвета, возвращаться до заката. Всё просто.`,
  },
  {
    img: GARDENROUTE_IMG,
    tag: "Маршруты",
    date: "10 дек 2025",
    title: "Садовый маршрут: 5 дней вдоль берега Индийского океана",
    excerpt: "От Кейптауна до Порт-Элизабет по самой живописной дороге ЮАР. Леса, лагуны, водопады и маленькие городки.",
    content: `Garden Route — одна из красивейших прибрежных дорог мира. Она тянется 300 километров от Муссельбей до Сторм-Ривер через леса, лагуны и маленькие белые городки.

**День 1: Херманус**

Лучшее место в мире для наблюдения за китами с берега. С июня по ноябрь южные киты приходят сюда рожать.

**День 2–3: Кнайсна**

Жемчужина маршрута. Лагуна, окружённая зелёными холмами. Устрицы здесь — лучшие в ЮАР.

**День 4: Цицикамма**

Национальный парк — лес, который спускается прямо к морю. Подвесной мост Storms River Mouth качается над пропастью.

**День 5: Порт-Элизабет**

Конечная точка. Пляжи длинные и пустые. Хорошее место, чтобы перевести дыхание.`,
  },
  {
    img: u("1580060839134-75a5edca2e99"),
    tag: "Природа",
    date: "28 янв 2026",
    title: "Столовая гора: как подняться и что взять с собой",
    excerpt: "Один из новых семи чудес природы над Кейптауном. Канатная дорога, пеший маршрут, облачная скатерть — полный гид.",
    content: `Столовая гора — это символ Кейптауна и одна из самых узнаваемых вершин мира. Её плоская вершина поднимается на 1086 метров.

**Канатная дорога**

Кабина вращается на 360 градусов во время подъёма. Очередь бывает длинной — приходите рано утром. Берите билеты онлайн заранее.

**Пеший маршрут**

Platteklip Gorge — около 2 часов в хорошем темпе. Тропа хорошо размечена, но потребует физической подготовки.

**Облачная скатерть**

Когда над горой стелется облако — виды становятся мистическими. Для похода выбирайте ясный день.

**Практически**

Тёплая куртка обязательна. Воды — минимум 1,5 литра. Солнцезащитный крем обязателен.`,
  },
  {
    img: u("1559494007-191dc1c7a2b8"),
    tag: "Безопасность",
    date: "25 янв 2026",
    title: "Безопасность в ЮАР: что нужно знать каждому туристу",
    excerpt: "ЮАР имеет репутацию страны с высокой преступностью. Но если знать правила — путешествие будет спокойным.",
    content: `Многих туристов отпугивает репутация ЮАР как опасной страны. При соблюдении базовых правил риск сводится к минимуму.

**Основные правила**

Не ходите пешком ночью в незнакомых районах. В машине блокируйте двери. Держите телефон убранным на улице.

**Безопасные места**

Waterfront в Кейптауне, Sandton в Йоханнесбурге, курортные города — вполне безопасны днём. Заповедники абсолютно безопасны.

**Транспорт**

Берите Uber — намного безопаснее уличных такси. Uber работает отлично, цены низкие.

**Главный совет**

ЮАР — не зона боевых действий. Миллионы туристов ездят сюда каждый год без единого инцидента.`,
  },
  {
    img: u("1476514525535-07fb3b4ae5f1"),
    tag: "Закаты",
    date: "20 янв 2026",
    title: "Лучшие места для наблюдения заката в ЮАР",
    excerpt: "Африканский закат — особое явление. 7 точек, где небо превращается в огненное полотно.",
    content: `Закат в Африке — это не просто красиво. Огромное красное солнце опускается за горизонт, небо становится оранжевым, потом фиолетовым, потом чёрным — за 20 минут.

**Signal Hill, Кейптаун**

Люди приезжают сюда с вином и пледами. Вид на город, гору и океан одновременно — бесплатно.

**Водопой в Крюгере**

Слоны и жирафы пьют воду на фоне оранжевого неба. Лучший закат, который я видел.

**Blyde River Canyon**

Третий по величине каньон в мире. На закате его красные стены светятся как раскалённый металл.

**Chapman's Peak Drive**

Горная дорога над Атлантикой. Каждая смотровая площадка — живая открытка.`,
  },
  {
    img: u("1506905925346-21bda4d32df4"),
    tag: "Природа",
    date: "15 янв 2026",
    title: "Драконовы горы (Дракенсберг): треккинг в ЮАР",
    excerpt: "Горный массив на границе с Лесото — один из самых живописных в Африке. Водопады и пещеры с наскальной живописью.",
    content: `Дракенсберг — горный хребет длиной почти 1000 км вдоль границы с Лесото.

**Что делать**

Треккинг — главное занятие. Маршруты на любой уровень: от лёгких прогулок до многодневных походов. Самый известный — к водопаду Тугела (второй по высоте в мире).

**Наскальная живопись**

Тысячи рисунков бушменов возрастом до 2500 лет. Объект ЮНЕСКО. Гид обязателен.

**Когда ехать**

Зима (июнь–август) — сухо, ясно, иногда снег на вершинах. Идеальная погода для треккинга.`,
  },
  {
    img: u("1571941994797-9bb7d4404d46"),
    tag: "Дикая природа",
    date: "10 янв 2026",
    title: "Пингвины ЮАР: как добраться до пляжа Боулдерс",
    excerpt: "Единственная в мире колония африканских пингвинов среди туристов. 30 минут от Кейптауна.",
    content: `На пляже Боулдерс обитает колония из нескольких тысяч африканских пингвинов. Они абсолютно не боятся людей.

**Как добраться**

45 минут от Кейптауна по прибрежной дороге. На поезде до Simon's Town, потом пешком.

**Что увидите**

Пингвины ходят по деревянным настилам, купаются рядом с туристами. Берите хорошую камеру.

**Лучшее время**

Ранее утро — меньше туристов. В сезон размножения (март–май) можно увидеть птенцов.`,
  },
  {
    img: u("1559827260-dc66d52bef19"),
    tag: "Города",
    date: "5 янв 2026",
    title: "Йоханнесбург: что смотреть и как не попасть в неприятности",
    excerpt: "Крупнейший город ЮАР часто пугает. Но здесь есть Soweto и лучшие рестораны страны.",
    content: `Йоханнесбург — «Город золота», финансовая столица Африки.

**Soweto**

Легендарный township, где вырос Мандела. Дом Манделы, музей апартеида, улица Вилакаци.

**Apartheid Museum**

Один из лучших музеев мира. Документирует историю апартеида с жуткими подробностями.

**Транспорт**

Только Uber. Никаких прогулок пешком вне туристических зон.`,
  },
  {
    img: u("1494500764479-0c8f2919a3d8"),
    tag: "Природа",
    date: "1 янв 2026",
    title: "Каньон реки Блайд: третье чудо Африки",
    excerpt: "Панорама Трёх Рондавелей, водопад Берлин, смотровая Бога Окна — один из самых впечатляющих каньонов мира.",
    content: `Blyde River Canyon — третий по величине каньон мира и самый зелёный.

**Три Рондавеля**

Три круглых скальных пика, похожих на традиционные хижины. Смотровая площадка — один из самых фотографируемых видов ЮАР.

**Окно Бога**

Смотровая площадка с видом вниз на бассейны с голубой водой. Глубина — несколько сотен метров.

**Как добраться**

Лучший вариант — арендованная машина. Каньон в провинции Мпумаланга, по дороге из Крюгера.`,
  },
  {
    img: u("1543946602-a0fce8117697"),
    tag: "Еда",
    date: "27 дек 2025",
    title: "Что едят в ЮАР: полный гастрономический гид",
    excerpt: "Браай, билтонг, боботи, малва-пудинг — еда в ЮАР отражает всё многообразие культур страны.",
    content: `Кухня ЮАР — смесь африканской, малайской, индийской и европейской традиций.

**Браай**

Национальный ритуал. Барбекю по-южноафрикански — образ жизни. Каждые выходные по всей стране люди разжигают огонь.

**Билтонг**

Вяленое мясо. Продаётся везде. Говядина, страус, антилопа.

**Вино**

ЮАР — один из крупнейших производителей вина. Стелленбос — обязателен к посещению.`,
  },
  {
    img: u("1516912481800-0f8f4f3e2a37"),
    tag: "Ночное небо",
    date: "22 дек 2025",
    title: "Астротуризм в ЮАР: смотреть на звёзды в Карру",
    excerpt: "Полупустыня Карру — одно из лучших мест в мире для наблюдения звёздного неба.",
    content: `Карру — одно из лучших мест на планете для астронаблюдений.

**Sutherland**

Маленький горный городок с Южноафриканской астрономической обсерваторией. Открыта для туристов — ночные экскурсии с телескопом.

**Что видно**

Магеллановы облака видны невооружённым глазом как размытые пятна.

**Когда ехать**

Новолуние — идеальное время. Зима — небо чище.`,
  },
  {
    img: u("1516426122078-c23e76319801"),
    tag: "Дикая природа",
    date: "18 дек 2025",
    title: "Носороги ЮАР: увидеть до того, как они исчезнут",
    excerpt: "ЮАР — дом большинства оставшихся носорогов планеты. Вот где их можно увидеть.",
    content: `ЮАР — страна, где живёт около 80% всех белых носорогов планеты.

**Где смотреть**

Крюгер-парк — лучшее место. Hluhluwe-iMfolozi Park — самый старый заповедник Африки.

**Браконьерство**

Только за 2023 год убили более 500 носорогов ради рога. Поддерживайте легальные заповедники.

**Этика**

Соблюдайте дистанцию. Никогда не выходите из машины рядом с носорогом.`,
  },
  {
    img: u("1529156069898-49953e39b3ac"),
    tag: "Культура",
    date: "14 дек 2025",
    title: "Зулусы: культура, традиции и как познакомиться",
    excerpt: "Крупнейший народ ЮАР. Традиции, боевые танцы и деревни открыты для туристов.",
    content: `Зулусы насчитывают около 12 миллионов человек.

**Культурные деревни**

PheZulu Safari Park и Shakaland — традиционные хижины, боевые танцы, зулусская кухня.

**Поле битвы при Изандлване**

В 1879 году зулусское войско уничтожило британский отряд. Музей очень подробный.

**Дурбан**

Самый индийский город Африки. Карри здесь лучше, чем в Индии.`,
  },
  {
    img: u("1501854140801-50d01698950b"),
    tag: "Маршруты",
    date: "10 дек 2025",
    title: "Мыс Доброй Надежды: на самый южный конец Африки",
    excerpt: "Атлантика встречается с Индийским океаном именно здесь.",
    content: `Мыс Доброй Надежды — одно из самых известных мест на планете. Португальцы открыли его в 1488 году.

**Как добраться**

Час от Кейптауна. Дорога через Чапмэнс-Пик — одна из красивейших прибрежных дорог мира.

**Заповедник**

Здесь гуляют страусы, павианы и зебры. Подъём на маяк — 30 минут пешком.

**Погода**

Ветер здесь почти всегда. В хорошую погоду вода двух океанов буквально разного цвета.`,
  },
  {
    img: u("1504006833117-84e27b16a87c"),
    tag: "Дикая природа",
    date: "5 дек 2025",
    title: "Леопарды Крюгера: почему их так сложно найти",
    excerpt: "Леопард — самый неуловимый из Большой пятёрки. Советы, как увеличить шансы на встречу.",
    content: `Леопард — мой любимый из Большой пятёрки. За две недели в Крюгере я видел его четыре раза.

**Где искать**

Центральная часть Крюгера — Сатара, Орпен. Берега рек. Утренние и вечерние выезды.

**Признаки присутствия**

Тушка антилопы на дереве. Крики обезьян. Тревожный лай импал.

**Ночное сафари**

Леопард активен именно в темноте. Записывайтесь на ночные выезды заранее.`,
  },
  {
    img: u("1564349683136-77e08dba1ef7"),
    tag: "Дикая природа",
    date: "1 дек 2025",
    title: "Зебры: полосатый мир Африки",
    excerpt: "Самые узнаваемые животные Африки. Где их больше всего и почему полосы — не просто декор.",
    content: `Зебра — лошадь с удивительной биологией и социальной структурой.

**Три вида в ЮАР**

Равнинная — самая распространённая. Горная — занесена в Красную книгу. Зебра Греви — самая редкая.

**Зачем полосы?**

Защита от насекомых, терморегуляция, запутывание хищника. Лев теряется в мелькании полос.

**Где смотреть**

Крюгер, Hluhluwe, Mountain Zebra National Park.`,
  },
  {
    img: u("1484318571209-661cf29a69d3"),
    tag: "Природа",
    date: "26 ноя 2025",
    title: "Фынбос: уникальная флора Кейптауна",
    excerpt: "Одна из шести флористических зон планеты, только в ЮАР. Протеи, эрики, рестии.",
    content: `Фынбос — мир растений, 70% из которых встречается только здесь.

**Где смотреть**

Столовая гора. Kirstenbosch Botanical Garden — тысячи видов. Cape Point — дикий фынбос.

**Когда цветёт**

Пик цветения — с сентября по ноябрь. Что-то цветёт круглый год.`,
  },
  {
    img: u("1559598467-f8b76c8155d0"),
    tag: "Вино",
    date: "8 ноя 2025",
    title: "Стелленбос: в сердце винного края ЮАР",
    excerpt: "Лучший винный регион Африки в 40 минутах от Кейптауна. Более 150 винодельных ферм.",
    content: `Стелленбос — второй по возрасту город ЮАР, основанный в 1679 году.

**Лучшие фермы**

Rust en Vrede, Tokara, Stellenbosch Hills, Jordan.

**Как дегустировать**

Аренда велосипеда и самостоятельный тур. Дегустация — от 100 до 300 рандов.

**Еда**

Рестораны на фермах — лучшие в ЮАР.`,
  },
  {
    img: u("1519046904884-53103b34b206"),
    tag: "Океан",
    date: "16 сен 2025",
    title: "Дайвинг в ЮАР: акулы, рифы и сардиновый бег",
    excerpt: "Большие белые акулы, коралловые рифы и грандиозный сардиновый бег.",
    content: `Две тысячи километров береговой линии — огромный мир под водой.

**Акулы в клетке, Gansbaai**

2 часа от Кейптауна. Мировая столица большой белой акулы.

**Сардиновый бег**

Июнь–июль. Миллиарды сардин мигрируют вдоль побережья. Одно из величайших природных зрелищ планеты.`,
  },
  {
    img: u("1531123897727-8f129e1688ce"),
    tag: "История",
    date: "22 сен 2025",
    title: "Нельсон Мандела: по следам великого человека",
    excerpt: "27 лет в тюрьме, первый президент свободной ЮАР. Маршрут по местам Манделы.",
    content: `Нельсон Мандела — одна из самых великих фигур XX века.

**Robben Island**

Остров в 12 км от Кейптауна, где Мандела провёл 18 лет. Экскурсию проводят бывшие заключённые.

**Soweto**

Дом-музей Манделы. Скромный, обычный. Рядом — дом Архиепископа Туту.

**Apartheid Museum**

Лучшее место для понимания контекста. Минимум 3 часа.`,
  },
  {
    img: u("1522204523234-8729aa6a3d39"),
    tag: "Закаты",
    date: "28 окт 2025",
    title: "Золотой час в саванне: как фотографировать дикую природу",
    excerpt: "Советы по фотографии животных в Крюгере. Освещение, выдержка, дистанция.",
    content: `Золотой час в саванне — самое красивое время суток.

**Настройки камеры**

Для движущихся животных — выдержка 1/500 и быстрее. ISO повышайте смело. Режим непрерывной съёмки.

**Терпение**

Лучшие кадры — у тех, кто останавливается и ждёт. Нашли льва — оставайтесь рядом час-два.

**Этика**

Никогда не шумите. Животное важнее кадра.`,
  },
  {
    img: u("1580060839134-75a5edca2e99"),
    tag: "Маршруты",
    date: "22 окт 2025",
    title: "Маршрут 14 дней по ЮАР: от Кейптауна до Крюгера",
    excerpt: "Идеальный маршрут для первого визита. Города, природа, сафари — за две недели.",
    content: `14 дней — минимальный срок, чтобы увидеть главное.

**Дни 1–4: Кейптаун**

Столовая гора, Bo-Kaap, Robben Island, пингвины Боулдерс.

**Дни 5–6: Садовый маршрут**

Херманус, Кнайсна, Цицикамма. Своя машина обязательна.

**Дни 9–13: Крюгер**

Пять дней в парке. Лагерь Сатара — идеальная база.`,
  },
  {
    img: u("1572987670199-b35d27c22b55"),
    tag: "Люди",
    date: "4 сен 2025",
    title: "Радужная нация: 11 официальных языков одной страны",
    excerpt: "ЮАР — самая многоязычная страна мира. Как это работает и почему это прекрасно.",
    content: `ЮАР — единственная страна с 11 официальными языками.

**Языки**

Зулу (23%), Коса (16%), Африкаанс (14%), Английский (10%) и ещё 7 языков.

**Ubuntu**

«Я есть потому, что мы есть». Коллективизм, взаимопомощь, уважение. Сердце Африки.

**Совет туристу**

Люди в ЮАР — самая большая достопримечательность. Открытые, готовые помочь.`,
  },
  {
    img: u("1507746212228-c45b46fad262"),
    tag: "Океан",
    date: "1 авг 2025",
    title: "Серфинг в ЮАР: лучшие пляжи и споты",
    excerpt: "J-Bay — лучшая правая волна на планете. Гид для начинающих и опытных серферов.",
    content: `ЮАР занимает особое место в мире серфинга.

**Jeffreys Bay (J-Bay)**

Один из легендарных серф-споттов. Правая волна длиной до 800 метров.

**Muizenberg, Кейптаун**

Лучшее место для начинающих — длинная, медленная волна, школы серфинга.

**Акулы**

Пляжи оборудованы сетями и дронами. Инциденты крайне редки.`,
  },
  {
    img: u("1545671913-b89ac1b4ac10"),
    tag: "Крюгер",
    date: "4 окт 2025",
    title: "Слоны Крюгера: жизнь в стаде",
    excerpt: "Как слоны живут, общаются и почему их в Крюгере стало слишком много.",
    content: `В Крюгере живёт около 20 000 слонов. Одно животное потребляет 200 кг растительности в день.

**Структура стада**

Матриархат. Старшая самка ведёт группу дочерей, внучек и правнучек.

**Интеллект**

Узнают себя в зеркале. Помнят умерших сородичей и возвращаются к их останкам.

**Лучшие точки**

Водопои Шипиндзини, Нвалетан — утром слоны приходят пить стадами по 50–100 голов.`,
  },
];

const TAGS = ["Все", ...Array.from(new Set(ALL_POSTS.map((p) => p.tag)))];

type Post = typeof ALL_POSTS[0];

function toSlug(title: string) {
  return encodeURIComponent(title.toLowerCase().replace(/\s+/g, "-").replace(/[^a-zа-я0-9-]/gi, ""));
}

function fromSlug(slug: string) {
  return ALL_POSTS.find((p) => toSlug(p.title) === slug) || null;
}

export default function Blog() {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  const [tag, setTag] = useState("Все");
  const [search, setSearch] = useState("");

  const openPost = searchParams.get("post") ? fromSlug(searchParams.get("post")!) : null;

  const setOpenPost = useCallback((post: Post | null) => {
    if (post) {
      setSearchParams({ post: toSlug(post.title) });
    } else {
      setSearchParams({});
    }
  }, [setSearchParams]);

  const [copied, setCopied] = useState(false);

  const copyLink = () => {
    navigator.clipboard.writeText(window.location.href);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const filtered = ALL_POSTS.filter((p) => {
    const matchTag = tag === "Все" || p.tag === tag;
    const matchSearch =
      !search ||
      p.title.toLowerCase().includes(search.toLowerCase()) ||
      p.excerpt.toLowerCase().includes(search.toLowerCase());
    return matchTag && matchSearch;
  });

  useEffect(() => {
    document.body.style.overflow = openPost ? "hidden" : "";
    return () => { document.body.style.overflow = ""; };
  }, [openPost]);

  useEffect(() => {
    if (!openPost) return;
    const onKey = (e: KeyboardEvent) => { if (e.key === "Escape") setOpenPost(null); };
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [openPost, setOpenPost]);

  return (
    <div className="min-h-screen bg-background text-foreground">
      {/* Header */}
      <header className="sticky top-0 z-40 bg-background/95 backdrop-blur border-b border-border">
        <div className="max-w-7xl mx-auto px-4 md:px-6 py-4 flex items-center gap-4 flex-wrap">
          <button
            onClick={() => navigate("/")}
            className="flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors"
          >
            <Icon name="ArrowLeft" size={18} />
            <span className="text-sm font-heading uppercase tracking-wide">Назад</span>
          </button>
          <div className="h-5 w-px bg-border" />
          <h1 className="font-heading text-lg font-bold uppercase text-foreground">
            Блог о ЮАР
          </h1>
          <div className="ml-auto flex items-center gap-2 bg-muted rounded-lg px-3 py-2">
            <Icon name="Search" size={15} className="text-muted-foreground" />
            <input
              type="text"
              placeholder="Поиск статей..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="bg-transparent text-sm text-foreground placeholder:text-muted-foreground outline-none w-40"
            />
          </div>
          <span className="text-xs text-muted-foreground font-body">
            {filtered.length} статей
          </span>
        </div>
      </header>

      {/* Tags */}
      <div className="border-b border-border bg-card sticky top-[61px] z-30">
        <div className="max-w-7xl mx-auto px-4 md:px-6">
          <div className="flex gap-2 overflow-x-auto py-3 scrollbar-none">
            {TAGS.map((t) => (
              <button
                key={t}
                onClick={() => setTag(t)}
                className={`flex-shrink-0 px-4 py-1.5 rounded-full text-xs font-heading uppercase tracking-wide transition-colors ${
                  tag === t
                    ? "bg-primary text-primary-foreground"
                    : "bg-muted text-muted-foreground hover:text-foreground"
                }`}
              >
                {t}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Grid */}
      <main className="max-w-7xl mx-auto px-4 md:px-6 py-10">
        {filtered.length === 0 ? (
          <div className="text-center py-20 text-muted-foreground font-body">
            Ничего не найдено. Попробуйте другой запрос.
          </div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {filtered.map((post, i) => (
              <article
                key={i}
                onClick={() => setOpenPost(post)}
                className="bg-card rounded-lg overflow-hidden border border-border cursor-pointer group hover:border-primary transition-colors"
              >
                <div className="relative h-52 overflow-hidden">
                  <img
                    src={post.img}
                    alt={post.title}
                    className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  />
                  <div className="absolute top-3 left-3 bg-primary text-primary-foreground text-xs font-heading uppercase tracking-wider px-3 py-1 rounded">
                    {post.tag}
                  </div>
                </div>
                <div className="p-5">
                  <div className="text-xs text-muted-foreground font-body mb-2 flex items-center gap-1.5">
                    <Icon name="Calendar" size={12} />
                    {post.date}
                  </div>
                  <h3 className="font-heading text-base font-semibold text-foreground uppercase leading-tight mb-3 group-hover:text-primary transition-colors">
                    {post.title}
                  </h3>
                  <p className="text-sm text-muted-foreground font-body leading-relaxed mb-4 line-clamp-3">
                    {post.excerpt}
                  </p>
                  <span className="text-primary text-sm font-heading uppercase tracking-wide flex items-center gap-1 group-hover:gap-2 transition-all">
                    Читать <Icon name="ArrowRight" size={14} />
                  </span>
                </div>
              </article>
            ))}
          </div>
        )}
      </main>

      {/* Modal */}
      {openPost && (
        <div
          className="fixed inset-0 z-50 flex items-start justify-center bg-black/80 backdrop-blur-sm overflow-y-auto py-8 px-4"
          onClick={() => setOpenPost(null)}
        >
          <div
            className="relative bg-card rounded-xl border border-border max-w-2xl w-full shadow-2xl"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="relative h-72 overflow-hidden rounded-t-xl">
              <img src={openPost.img} alt={openPost.title} className="w-full h-full object-cover" />
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
              <button
                onClick={() => setOpenPost(null)}
                className="absolute top-4 right-4 w-9 h-9 rounded-full bg-black/50 flex items-center justify-center text-white hover:bg-black/80 transition-colors"
              >
                <Icon name="X" size={18} />
              </button>
              <div className="absolute bottom-4 left-5">
                <span className="bg-primary text-primary-foreground text-xs font-heading uppercase tracking-wider px-3 py-1 rounded">
                  {openPost.tag}
                </span>
              </div>
            </div>
            <div className="p-6 md:p-8">
              <div className="flex items-center gap-1.5 text-xs text-muted-foreground font-body mb-3">
                <Icon name="Calendar" size={12} />
                {openPost.date}
              </div>
              <h2 className="font-heading text-2xl md:text-3xl font-bold text-foreground uppercase leading-tight mb-6">
                {openPost.title}
              </h2>
              <div className="prose prose-sm max-w-none text-muted-foreground font-body leading-relaxed space-y-4">
                {openPost.content.split("\n\n").map((para, i) => {
                  if (para.startsWith("**") && para.endsWith("**")) {
                    return (
                      <h3 key={i} className="font-heading font-bold text-foreground uppercase tracking-wide text-sm mt-6">
                        {para.replace(/\*\*/g, "")}
                      </h3>
                    );
                  }
                  if (para.includes("**")) {
                    return (
                      <p key={i} dangerouslySetInnerHTML={{ __html: para.replace(/\*\*(.*?)\*\*/g, '<strong class="text-foreground">$1</strong>') }} />
                    );
                  }
                  return <p key={i}>{para}</p>;
                })}
              </div>
              <div className="mt-8 pt-6 border-t border-border space-y-3">
                <p className="text-xs text-muted-foreground font-body">Понравилась статья? Поделись с друзьями!</p>
                <div className="flex flex-wrap items-center gap-2">
                  {/* Copy link */}
                  <button
                    onClick={copyLink}
                    className="inline-flex items-center gap-2 bg-muted border border-border text-foreground px-4 py-2 rounded font-heading font-semibold uppercase tracking-wide text-xs hover:border-primary transition-all"
                  >
                    <Icon name={copied ? "Check" : "Link"} size={13} />
                    {copied ? "Ссылка скопирована!" : "Копировать ссылку"}
                  </button>
                  {/* Telegram */}
                  <a
                    href={`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(openPost.title + "\n\n" + openPost.excerpt)}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 bg-[#229ED9] text-white px-4 py-2 rounded font-heading font-semibold uppercase tracking-wide text-xs hover:bg-[#1a8bbf] transition-all"
                  >
                    <Icon name="Send" size={13} />
                    Telegram
                  </a>
                  {/* WhatsApp */}
                  <a
                    href={`https://wa.me/?text=${encodeURIComponent(openPost.title + "\n" + window.location.href)}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 bg-[#25D366] text-white px-4 py-2 rounded font-heading font-semibold uppercase tracking-wide text-xs hover:bg-[#1ebe5d] transition-all"
                  >
                    <Icon name="MessageCircle" size={13} />
                    WhatsApp
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}